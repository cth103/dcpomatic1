!include "MUI2.nsh"
Name "DVD-o-matic"

RequestExecutionLevel admin

outFile "DVD-o-matic @version@ Installer.exe"
!define MUI_ICON "%resources%/dvdomatic.ico"
!define MUI_UNICON "%resources%/dvdomatic.ico"
!define MUI_SPECIALBITMAP "%resources%/dvdomatic.bmp"

InstallDir "$PROGRAMFILES\DVD-o-matic"

!insertmacro MUI_PAGE_WELCOME
!insertmacro MUI_PAGE_LICENSE "../../COPYING"
!insertmacro MUI_PAGE_DIRECTORY
!insertmacro MUI_PAGE_INSTFILES
!insertmacro MUI_PAGE_FINISH

!insertmacro MUI_UNPAGE_WELCOME
!insertmacro MUI_UNPAGE_CONFIRM
!insertmacro MUI_UNPAGE_INSTFILES
!insertmacro MUI_UNPAGE_FINISH
 
!insertmacro MUI_LANGUAGE "English"

Section "install" "Installation info"
 
SetOutPath "$INSTDIR\bin"

File "%deps%/bin/asdcp-libdcp.dll"
File "%deps%/bin/avcodec-54.dll"
File "%deps%/bin/avfilter-3.dll"
File "%deps%/bin/avformat-54.dll"
File "%deps%/bin/avutil-51.dll"
File "%deps%/bin/dcp.dll"
File "%deps%/bin/intl.dll"
File "%deps%/bin/kumu-libdcp.dll"
File "%deps%/bin/libboost_chrono-mt.dll"
File "%deps%/bin/libboost_filesystem-mt.dll"
File "%deps%/bin/libboost_system-mt.dll"
File "%deps%/bin/libboost_thread_win32-mt.dll"
File "%deps%/bin/libeay32.dll"
File "%deps%/bin/libgcc_s_sjlj-1.dll"
File "%deps%/bin/libgdk-win32-2.0-0.dll"
File "%deps%/bin/libgdk_pixbuf-2.0-0.dll"
File "%deps%/bin/libgio-2.0-0.dll"
File "%deps%/bin/libglib-2.0-0.dll"
File "%deps%/bin/libgobject-2.0-0.dll"
File "%deps%/bin/libgtk-win32-2.0-0.dll"
File "%deps%/bin/libjpeg-7.dll"
File "%deps%/bin/libMagick++-5.dll"
File "%deps%/bin/libMagickCore-5.dll"
File "%deps%/bin/libMagickWand-5.dll"
File "%deps%/bin/libopenjpeg-1.dll"
File "%deps%/bin/libpng14-14.dll"
File "%deps%/bin/libsigc-2.0-0.dll"
File "%deps%/bin/libsndfile-1.dll"
File "%deps%/bin/libssh.dll"
File "%deps%/bin/libstdc++-6.dll"
File "%deps%/bin/postproc-52.dll"
File "%deps%/bin/swresample-0.dll"
File "%deps%/bin/swscale-2.dll"
File "%deps%/bin/zlib1.dll"
File "%deps%/bin/libjpeg-8.dll"
File "%deps%/bin/wxbase28_gcc_custom.dll"
File "%deps%/bin/wxmsw28_core_gcc_custom.dll"
File "%deps%/bin/wxmsw28_adv_gcc_custom.dll"
File "%deps%/bin/libcairo-2.dll"
File "%deps%/bin/libfontconfig-1.dll"
File "%deps%/bin/libexpat-1.dll"
File "%deps%/bin/freetype6.dll"
File "%deps%/bin/libgthread-2.0-0.dll"
File "%deps%/bin/libpango-1.0-0.dll"
File "%deps%/bin/libgmodule-2.0-0.dll"
File "%deps%/bin/libpangocairo-1.0-0.dll"
File "%deps%/bin/libpangoft2-1.0-0.dll"
File "%deps%/bin/libpangowin32-1.0-0.dll"
File "%deps%/bin/libtiff3.dll"
File "%deps%/bin/jpeg62.dll"
File "%deps%/bin/libglibmm-2.4-1.dll"
File "%deps%/bin/libxml++-2.6-2.dll"
File "%deps%/bin/libxml2-2.dll"

File "%binaries%/src/wx/dvdomatic-wx.dll"
File "%binaries%/src/lib/dvdomatic.dll"
File "%binaries%/src/tools/dvdomatic.exe"
File "%binaries%/src/tools/servomatic_cli.exe"
File "%binaries%/src/tools/servomatic_gui.exe"

CreateShortCut "$DESKTOP\DVD-o-matic.lnk" "$INSTDIR\bin\dvdomatic.exe" ""
CreateShortCut "$DESKTOP\DVD-o-matic encode server.lnk" "$INSTDIR\bin\servomatic_gui.exe" ""
 
CreateDirectory "$SMPROGRAMS\DVD-o-matic"
CreateShortCut "$SMPROGRAMS\DVD-o-matic\Uninstall.lnk" "$INSTDIR\Uninstall.exe" "" "$INSTDIR\Uninstall.exe" 0
CreateShortCut "$SMPROGRAMS\DVD-o-matic\DVD-o-matic.lnk" "$INSTDIR\bin\dvdomatic.exe" "" "$INSTDIR\bin\dvdomatic.exe" 0
CreateShortCut "$SMPROGRAMS\DVD-o-matic\DVD-o-matic encode server.lnk" "$INSTDIR\bin\servomatic_gui.exe" "" "$INSTDIR\bin\servomatic_gui.exe" 0
 
WriteRegStr HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\DVD-o-matic" "DisplayName" "DVD-o-matic (remove only)"
WriteRegStr HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\DVD-o-matic" "UninstallString" "$INSTDIR\Uninstall.exe"
 
WriteUninstaller "$INSTDIR\Uninstall.exe"
 
SectionEnd
 
 
Section "Uninstall"
 
RMDir /r "$INSTDIR\*.*"    
RMDir "$INSTDIR"
Delete "$DESKTOP\DVD-o-matic.lnk"
Delete "$SMPROGRAMS\DVD-o-matic\*.*"
RmDir  "$SMPROGRAMS\DVD-o-matic"
DeleteRegKey HKEY_LOCAL_MACHINE "SOFTWARE\DVD-o-matic"
DeleteRegKey HKEY_LOCAL_MACHINE "SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\DVD-o-matic"
 
SectionEnd
